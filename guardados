async function crearFactura() {
    const cliente = document.getElementById("cliente").value;

    if (!cliente) {
        alert("Ingrese el nombre del cliente.");
        return;
    }

    const res = await fetch("/facturas", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombre_cliente: cliente })
    });

    const factura = await res.json();
    alert(`Factura creada con ID: ${factura.id_factura}`);
    cargarFacturas();
}

async function agregarProducto() {
    const idFactura = prompt("Ingrese el ID de la factura:");
    const producto = document.getElementById("producto").value;
    const cantidad = document.getElementById("cantidad").value;
    const precio = document.getElementById("precio").value;

    if (!idFactura || !producto || !cantidad || !precio) {
        alert("Complete todos los campos.");
        return;
    }

    await fetch("/facturas/detalles", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            id_factura: idFactura,
            producto: producto,
            cantidad: parseInt(cantidad),
            precio: parseFloat(precio)
        })
    });

    alert("Producto agregado.");
    cargarFacturas();
}

async function cargarFacturas() {
    const res = await fetch("/facturas");
    const facturas = await res.json();
    const lista = document.getElementById("listaFacturas");
    lista.innerHTML = "";

    facturas.forEach(factura => {
        const li = document.createElement("li");
        li.innerHTML = `
            Factura #${factura.id_factura} - Cliente: ${factura.nombre_cliente}
            <button onclick="descargarPDF(${factura.id_factura})">Descargar PDF</button>
        `;
        lista.appendChild(li);
    });
}

function descargarPDF(id) {
    window.open(`/facturas/${id}/pdf`, "_blank");
}

cargarFacturas();
